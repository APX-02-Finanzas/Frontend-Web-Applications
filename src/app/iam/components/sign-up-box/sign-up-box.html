<form class="signup-panel" [formGroup]="form" (ngSubmit)="onSubmit()">
  <h2 class="title">Regístrate</h2>

  <div class="row" style="display:flex; gap:12px; align-items:flex-start;">
    <div class="col field" style="flex:1">
      <div class="field-head">
        <label class="label">Nombre *</label>
        <div class="inline-error" *ngIf="nameCtrl?.touched && nameCtrl?.invalid">
          <span *ngIf="nameCtrl?.errors?.['required']">El nombre es obligatorio.</span>
        </div>
      </div>
      <div class="input-row">
        <input class="input" type="text" formControlName="name" />
      </div>
    </div>

    <div class="col field" style="flex:1">
      <div class="field-head">
        <label class="label">Apellido *</label>
        <div class="inline-error" *ngIf="surnameCtrl?.touched && surnameCtrl?.invalid">
          <span *ngIf="surnameCtrl?.errors?.['required']">El apellido es obligatorio.</span>
        </div>
      </div>
      <div class="input-row">
        <input class="input" type="text" formControlName="surname" />
      </div>
    </div>
  </div>

  <div class="field">
    <div class="field-head">
      <label class="label">Correo *</label>
      <div class="inline-error" *ngIf="emailCtrl?.touched && emailCtrl?.invalid">
        <span *ngIf="emailCtrl?.errors?.['required']">El correo es obligatorio.</span>
        <span *ngIf="emailCtrl?.errors?.['email']">Formato de correo inválido.</span>
      </div>
    </div>
    <div class="input-row">
      <input class="input" type="email" formControlName="email" />
    </div>
  </div>

  <div class="field">
    <div class="field-head">
      <label class="label">Usuario *</label>
      <div class="inline-error" *ngIf="usernameCtrl?.touched && usernameCtrl?.invalid">
        <span *ngIf="usernameCtrl?.errors?.['required']">El usuario es obligatorio.</span>
      </div>
    </div>
    <div class="input-row">
      <input class="input" type="text" formControlName="username" />
    </div>
  </div>

  <div class="field">
    <div class="field-head">
      <label class="label">Contraseña *</label>
      <div class="inline-error" *ngIf="passwordCtrl?.touched && passwordCtrl?.invalid">
        <span *ngIf="passwordCtrl?.errors?.['required']">La contraseña es obligatoria.</span>
        <span *ngIf="passwordCtrl?.errors?.['minlength']">La contraseña debe tener al menos 3 caracteres.</span>
      </div>
    </div>
    <div class="input-row">
      <input class="input" [attr.type]="passwordVisible ? 'text' : 'password'" formControlName="password" />
      <button type="button" class="toggle-pass-text" (click)="togglePasswordVisibility()" [attr.aria-label]="passwordVisible ? 'Ocultar contraseña' : 'Mostrar contraseña'">
        {{ passwordVisible ? 'Ocultar' : 'Mostrar' }}
      </button>
    </div>
  </div>

  <div class="field">
    <div class="field-head">
      <label class="label">Confirmar contraseña *</label>
      <div class="inline-error" *ngIf="confirmPasswordCtrl?.touched && (confirmPasswordCtrl?.invalid || form.errors?.['passwordMismatch'])">
        <span *ngIf="confirmPasswordCtrl?.errors?.['required']">Confirmar contraseña es obligatorio.</span>
        <span *ngIf="form.errors?.['passwordMismatch'] && confirmPasswordCtrl?.touched">Las contraseñas no coinciden.</span>
      </div>
    </div>
    <div class="input-row">
      <input class="input" [attr.type]="confirmPasswordVisible ? 'text' : 'password'" formControlName="confirmPassword" />
      <button type="button" class="toggle-pass-text" (click)="toggleConfirmPasswordVisibility()" [attr.aria-label]="confirmPasswordVisible ? 'Ocultar contraseña' : 'Mostrar contraseña'">
        {{ confirmPasswordVisible ? 'Ocultar' : 'Mostrar' }}
      </button>
    </div>
  </div>

  <div class="field terms-field">
    <label class="terms-container">
      <input type="checkbox" formControlName="terms" />
      <span>
      Acepto los
      <a href="#" (click)="toggleTerms($event)">Términos y Condiciones</a>
    </span>
    </label>

    <div class="terms-error" *ngIf="termsCtrl?.touched && termsCtrl?.invalid">
      Debes aceptar los términos y condiciones.
    </div>
  </div>




  <div style="margin-top:14px; display:flex; justify-content:center;">
    <div id="recaptcha-container"></div>
  </div>

  <div *ngIf="captchaError" class="inline-error" style="text-align:center; margin-top:8px;">
    Por favor completa el captcha correctamente.
  </div>

  <button class="btn" type="submit" [disabled]="form.invalid || submitting">
    Crear cuenta
  </button>

  <div class="login-link">
    ¿Ya tienes una cuenta? <a href="#" (click)="onSwitchToSignIn($event)">Iniciar sesión</a>
  </div>
</form>
<div class="terms-backdrop" *ngIf="showTerms">
  <div class="terms-modal">
    <header class="terms-header">
      <h2>Términos y condiciones de la aplicación</h2>
      <button type="button" class="close-btn" (click)="closeTerms()">✕</button>
    </header>

    <div class="terms-body">
      <p>
        Esta aplicación está diseñada para gestionar cuentas de usuario, registrar
        solicitudes y facilitar la atención comercial de manera digital. Al crear
        una cuenta, aceptas usar la plataforma de forma responsable y conforme a la
        normativa vigente.
      </p>
      <p>
        Los datos personales que proporciones (nombre, correo, usuario, etc.) serán
        utilizados únicamente para crear tu cuenta, autenticar tu acceso y
        comunicarte información relacionada a nuestros servicios. No compartiremos
        tu información con terceros no autorizados, salvo obligación legal.
      </p>
      <p>
        Nos reservamos el derecho de suspender o bloquear cuentas que realicen un
        uso indebido del sistema, intenten vulnerar la seguridad o incumplan estos
        términos. El acceso a la plataforma puede verse limitado por mantenimientos
        o incidencias técnicas.
      </p>
      <p>
        Por ultimo el cliente tendra que tener en cuenta que la vivienda por financiar
        no debe tener un precio mayor a los S/ 427,600, debe ser la única vivienda registrada
        en SUNARP a tu nombre, la de tu cónyuge / conviviente o hijos menores de edad, y
        Para acceder a los Bonos, no debes haber sido beneficiado anteriormente con recursos del
        Estado para la compra de viviendas (por ejemplo: Techo Propio, FONAVI, BANMAT, etc)

      </p>
      <p>
        Al continuar con el registro, declaras que la información ingresada es
        veraz y aceptas estos términos y condiciones de uso de la aplicación.
      </p>
    </div>

    <footer class="terms-footer">
      <button type="button" (click)="closeTerms()">Aceptar</button>
    </footer>
  </div>
</div>
